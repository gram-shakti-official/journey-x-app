<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JourneyX - Premium Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB0_3QZj4Yi_ggTtRXQFySjV8NSXtqjsic",
            authDomain: "journeyx-68a6a.firebaseapp.com",
            databaseURL: "https://journeyx-68a6a-default-rtdb.firebaseio.com",
            projectId: "journeyx-68a6a",
            storageBucket: "journeyx-68a6a.firebasestorage.app",
            messagingSenderId: "926400211410",
            appId: "1:926400211410:web:16b8b2dbac2e5e8309800b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentTripType = 'one-way';
        const rates = { "Mini": 9, "Sedan": 12, "Ertiga": 15, "Innova": 20, "Luxury": 65 };
        const nightCharges = { "Mini": 300, "Sedan": 300, "Ertiga": 500, "Innova": 500, "Luxury": 1000 };

        // --- Custom Alert System (No Browser URL) ---
        window.showCustomAlert = (msg) => {
            document.getElementById('alertMessage').innerText = msg;
            document.getElementById('customAlertBox').classList.remove('hidden');
        };
        window.closeAlert = () => document.getElementById('customAlertBox').classList.add('hidden');

        // --- Simple Verification (Avoids Billing Errors) ---
        window.startBooking = () => {
            const phone = document.getElementById('uPhone').value;
            if (phone.length < 10) { showCustomAlert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç!"); return; }
            
            // ‡§∏‡•Ä‡§ß‡•á ‡§≤‡•â‡§ó‡§ø‡§® (No SMS Cost) - ‡§Ü‡§™ ‡§á‡§∏‡•á Firebase Console ‡§Æ‡•á‡§Ç Test Number ‡§ï‡•á ‡§∏‡§æ‡§• ‡§≠‡•Ä ‡§ú‡•ã‡•ú ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç
            document.getElementById('loginOverlay').classList.add('hidden');
            showCustomAlert("‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡§´‡§≤! ‡§Ö‡§¨ ‡§Ö‡§™‡§®‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç‡•§");
        };

        window.setTripType = (type) => {
            currentTripType = type;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.replace('bg-white', 'bg-blue-800'));
            event.target.classList.replace('bg-blue-800', 'bg-white');
            calculateFare();
        };

        window.calculateFare = () => {
            let dist = parseFloat(document.getElementById('distance').value) || 0;
            const car = document.getElementById('carSelect').value;
            const time = document.getElementById('pickupTime').value;
            const fareDisplay = document.getElementById('fareAmount');

            if(dist >= 0 && car) {
                let effDist = (currentTripType === 'package' && dist < 250) ? 250 : dist;
                let total = effDist * rates[car];
                if (total < 1000) total = 1000;

                let extra = 0;
                if(currentTripType !== 'one-way' && time) {
                    const hr = parseInt(time.split(':')[0]);
                    if(hr >= 23 || hr < 6) extra = nightCharges[car];
                }
                fareDisplay.innerText = "‚Çπ" + Math.round(total + extra);
                document.getElementById('totalBox').classList.remove('hidden');
            }
        };

        window.confirmAction = () => {
            const name = document.getElementById('uName').value;
            const dist = document.getElementById('distance').value;
            if(!name || !dist) { showCustomAlert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§¶‡•Ç‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç!"); return; }
            document.getElementById('agreementPopup').classList.remove('hidden');
        };

        window.finalSubmit = async function() {
            const name = document.getElementById('uName').value;
            const phone = document.getElementById('uPhone').value;
            const fare = document.getElementById('fareAmount').innerText;
            const car = document.getElementById('carSelect').value;

            try {
                // Firebase ‡§Æ‡•á‡§Ç ‡§°‡•á‡§ü‡§æ ‡§≠‡•á‡§ú‡§®‡§æ
                await addDoc(collection(db, "bookings"), {
                    name, phone, tripType: currentTripType, fare, car, timestamp: serverTimestamp()
                });

                // Telegram Alert
                const botToken = "7954151806:AAHy2Q3nePpv_CqA9ymfhEmg33B229ORClI";
                const chatId = "5670868884";
                const msg = `üöÄ *‡§®‡§à ‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó!*%0Aüë§: ${name}%0Aüì±: ${phone}%0Aüöó: ${car}%0Aüí∞: ${fare}`;
                await fetch(`https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatId}&text=${msg}&parse_mode=Markdown`);

                document.getElementById('agreementPopup').classList.add('hidden');
                showCustomAlert("‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó ‡§∏‡§´‡§≤! ‡§π‡§Æ ‡§Ü‡§™‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á‡•§");
                setTimeout(() => location.reload(), 3000);
            } catch (e) { showCustomAlert("‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§è‡§∞‡§∞!"); }
        };
    </script>
</head>
<body class="bg-gray-100 flex justify-center min-h-screen">

    <div id="customAlertBox" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-[200] p-6">
        <div class="bg-white rounded-3xl p-8 max-w-xs w-full text-center shadow-2xl">
            <p id="alertMessage" class="text-gray-800 font-bold mb-6"></p>
            <button onclick="closeAlert()" class="w-full bg-blue-900 text-white py-3 rounded-xl font-bold">‡§†‡•Ä‡§ï ‡§π‡•à</button>
        </div>
    </div>

    <div id="loginOverlay" class="fixed inset-0 bg-blue-900 z-[100] flex flex-col items-center justify-center p-8 text-white">
        <h2 class="text-4xl font-black italic mb-8">JourneyX</h2>
        <div class="w-full max-w-xs space-y-4 text-center">
            <p class="text-xs text-blue-200 mb-2 uppercase font-bold tracking-widest">Login with WhatsApp Number</p>
            <input id="uPhone" type="tel" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç" class="w-full p-4 rounded-2xl bg-white/10 border border-white/20 text-white outline-none text-center">
            <button onclick="startBooking()" class="w-full bg-white text-blue-900 py-4 rounded-2xl font-bold uppercase">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
        </div>
    </div>

    <div class="w-full max-w-md bg-white shadow-2xl relative min-h-screen">
        <div class="bg-blue-900 p-6 rounded-b-[40px] text-white">
            <h1 class="text-3xl font-black italic">JourneyX</h1>
            <div class="flex bg-blue-800 mt-4 p-1 rounded-xl text-[10px] font-bold uppercase">
                <button onclick="setTripType('one-way')" class="tab-btn flex-1 bg-white text-blue-900 py-2 rounded-lg">One Way</button>
                <button onclick="setTripType('round-trip')" class="tab-btn flex-1 py-2 rounded-lg">Round Trip</button>
                <button onclick="setTripType('package')" class="tab-btn flex-1 py-2 rounded-lg">Package</button>
            </div>
            <div class="mt-4 space-y-2">
                <input id="pickupTime" type="time" onchange="calculateFare()" class="w-full p-3 rounded-xl bg-blue-800 text-white outline-none">
                <input id="distance" type="number" oninput="calculateFare()" placeholder="‡§ï‡•Å‡§≤ ‡§ï‡§ø‡§≤‡•ã‡§Æ‡•Ä‡§ü‡§∞ (KM)" class="w-full p-3 rounded-xl bg-blue-800 text-white outline-none">
            </div>
        </div>

        <div class="p-6">
            <select id="carSelect" onchange="calculateFare()" class="w-full p-4 border rounded-2xl font-bold mb-6 bg-gray-50 outline-none">
                <option value="Mini">Mini (‚Çπ9/km)</option>
                <option value="Sedan">Sedan (‚Çπ12/km)</option>
                <option value="Ertiga">Ertiga (‚Çπ15/km)</option>
                <option value="Innova">Innova Crysta (‚Çπ20/km)</option>
                <option value="Luxury">Luxury (‚Çπ65/km)</option>
            </select>

            <div id="totalBox" class="hidden bg-blue-50 border-2 border-blue-200 p-5 rounded-3xl mb-6 text-center">
                <p class="text-blue-800 text-xs font-bold uppercase">Estimated Fare</p>
                <h2 id="fareAmount" class="text-4xl font-black text-blue-900">‚Çπ0</h2>
                <p id="nightChargeLabel" class="text-[10px] text-red-600 font-bold mt-2 hidden uppercase"></p>
            </div>

            <input id="uName" type="text" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ" class="w-full p-3 border rounded-xl outline-none mb-6">
            <button onclick="confirmAction()" class="w-full bg-blue-900 text-white py-4 rounded-2xl font-bold text-lg shadow-xl uppercase">Confirm Booking</button>
        </div>

        <div id="agreementPopup" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-6 z-[60]">
            <div class="bg-red-600 text-white p-8 rounded-[40px] text-center max-w-sm">
                <h2 class="text-2xl font-bold mb-4">‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§∏‡•Ç‡§ö‡§®‡§æ!</h2>
                <p class="text-sm mb-6">‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ **State Tax, Toll Tax ‡§î‡§∞ Parking** ‡§Ö‡§≤‡§ó ‡§∏‡•á ‡§¶‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à‡§Ç?</p>
                <div class="flex flex-col space-y-3">
                    <button onclick="finalSubmit()" class="bg-white text-red-600 py-3 rounded-xl font-bold">‡§π‡§æ‡§Å, ‡§Æ‡•à‡§Ç ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•Ç‡§Å</button>
                    <button onclick="document.getElementById('agreementPopup').classList.add('hidden')" class="text-white text-xs uppercase font-bold">‡§®‡§π‡•Ä‡§Ç, ‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
